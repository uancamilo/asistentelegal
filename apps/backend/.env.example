# ==========================================
# AsistenciaLegal - Backend Environment Variables
# ==========================================
#
# IMPORTANT: This file is a TEMPLATE.
# Copy it to .env and fill with real values:
#   $ cp .env.example .env
#
# NEVER commit .env file to Git!
# ==========================================

# ==========================================
# DATABASE CONFIGURATION
# ==========================================
# PostgreSQL connection string (Neon.tech or local)
# Recommended parameters for Neon pooled connections:
#   - sslmode=require (mandatory for cloud databases)
#   - connect_timeout=10 (connection timeout in seconds)
#   - pool_timeout=10 (pool acquisition timeout)
#   - connection_limit=5 (max connections from this instance)
#
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?params
#
# Example for local PostgreSQL:
# DATABASE_URL="postgresql://postgres:postgres@localhost:5432/asistencialegal?sslmode=prefer"
#
# Example for Neon.tech (use pooler endpoint):
DATABASE_URL="postgresql://USER:PASSWORD@HOST/DATABASE?sslmode=require&connect_timeout=10&pool_timeout=10&connection_limit=5"

# ==========================================
# SUPER ADMIN CREDENTIALS
# ==========================================
# Used by: npm run init-superadmin
# These credentials create the first SUPER_ADMIN user
#
# ⚠️ SECURITY WARNING:
# Change these immediately after first login in production!

ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="CHANGE_ME_IN_PRODUCTION"

# ==========================================
# EMPLOYEE CREDENTIALS
# ==========================================
# Used by: npm run init-admins
# These credentials create ADMIN and EDITOR users
#
# ⚠️ SECURITY WARNING:
# Change these immediately after first login in production!

SECONDARY_ADMIN_PASSWORD="CHANGE_ME_IN_PRODUCTION"
EDITOR_PASSWORD="CHANGE_ME_IN_PRODUCTION"

# ==========================================
# NESTJS APPLICATION CONFIGURATION
# ==========================================
# Port for the NestJS application
# Development: 8080 (to avoid conflict with frontend on 3000)
# Production: Configure via hosting provider
PORT=8080

# Node environment (development, production, test)
NODE_ENV=development

# Cookie secure flag (true to require HTTPS for cookies)
# Production: Always true (enforced automatically)
# Development: Set to true if using HTTPS (recommended for security testing)
COOKIE_SECURE=false

# ==========================================
# CORS CONFIGURATION
# ==========================================
# Allowed origin for CORS (frontend URL)
# Development: http://localhost:3000
# Production: https://yourdomain.com
CORS_ORIGIN=http://localhost:3000

# ==========================================
# JWT CONFIGURATION
# ==========================================
# JWT secret for access tokens (minimum 32 characters)
# Generate with: openssl rand -base64 32
JWT_SECRET="CHANGE_ME_GENERATE_WITH_OPENSSL_RAND_BASE64_32"

# Access token expiration (e.g., 15m, 1h, 1d)
JWT_EXPIRATION=15m

# JWT secret for refresh tokens (minimum 32 characters, MUST be different from JWT_SECRET)
# Generate with: openssl rand -base64 32
JWT_REFRESH_SECRET="CHANGE_ME_GENERATE_WITH_OPENSSL_RAND_BASE64_32"

# Refresh token expiration (e.g., 7d, 30d)
JWT_REFRESH_EXPIRATION=7d

# ==========================================
# REDIS CONFIGURATION (Optional)
# ==========================================
# Redis URL for distributed caching and rate limiting
# Format: redis://[:password@]host:port/db
#
# If not set, the application will:
#   - Disable Redis-based caching (fallback to in-memory)
#   - Disable Redis-based rate limiting (fallback to in-memory)
#
# Development: redis://localhost:6379/0
# Production: Use managed Redis (e.g., Redis Cloud, AWS ElastiCache)
#
# Leave empty to disable Redis:
# REDIS_URL=
#
# Or configure connection:
REDIS_URL=redis://localhost:6379/0

# ==========================================
# OPENAI CONFIGURATION
# ==========================================
# OpenAI API Key for embeddings and chat completions
# Get your API key from: https://platform.openai.com/api-keys
#
# Required for:
#   - Generating embeddings for document search
#   - RAG (Retrieval-Augmented Generation) chat
#
# ⚠️ SECURITY WARNING:
# Never commit this key to Git!
# Monitor usage in OpenAI dashboard to prevent unexpected charges

OPENAI_API_KEY="sk-..."

# OpenAI model for embeddings (default: text-embedding-3-small)
# Options:
#   - text-embedding-3-small (cheaper, 1536 dimensions)
#   - text-embedding-3-large (better quality, 3072 dimensions)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# OpenAI model for chat completions (default: gpt-3.5-turbo)
# Options:
#   - gpt-3.5-turbo (cheaper, good quality)
#   - gpt-4o-mini (balanced cost/quality)
#   - gpt-4 (best quality, more expensive)
OPENAI_CHAT_MODEL=gpt-3.5-turbo

# Maximum tokens for chat responses (default: 1000)
OPENAI_MAX_TOKENS=1000

# Temperature for chat responses (0-2, default: 0.7)
# Lower = more focused, Higher = more creative
OPENAI_TEMPERATURE=0.7

# ==========================================
# FILE STORAGE CONFIGURATION
# ==========================================
# Storage type: local or s3 (default: local)
# Development: local
# Production: s3 (recommended)
STORAGE_TYPE=local

# Local storage path (only for STORAGE_TYPE=local)
# Path where uploaded PDFs will be stored
# Must be writable by the application
STORAGE_LOCAL_PATH=./uploads

# Maximum file size in bytes (default: 52428800 = 50MB)
MAX_FILE_SIZE=52428800

# Allowed MIME types (comma-separated)
ALLOWED_MIME_TYPES=application/pdf

# ==========================================
# AWS S3 CONFIGURATION (Optional)
# ==========================================
# Only required if STORAGE_TYPE=s3
# Get credentials from AWS IAM console
#
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key
# AWS_REGION=us-east-1
# AWS_S3_BUCKET=asistentelegal-documents

# ==========================================
# BULL QUEUE CONFIGURATION
# ==========================================
# Bull uses Redis for job queue management
# Uses REDIS_URL configured above
#
# Number of concurrent jobs for PDF processing (default: 2)
# Adjust based on CPU/RAM availability
QUEUE_PDF_CONCURRENCY=2

# Job retry attempts on failure (default: 3)
QUEUE_MAX_RETRIES=3

# ==========================================
# SECURITY NOTES
# ==========================================
# 1. Use strong passwords (min 12 characters, uppercase, lowercase, numbers, symbols)
# 2. Never share .env file or commit it to version control
# 3. Rotate passwords every 90 days in production
# 4. Use different passwords for each environment (dev/staging/production)
# 5. Generate JWT secrets with: openssl rand -base64 32
# 6. For production, use managed secrets (AWS Secrets Manager, HashiCorp Vault, etc.)
# 7. Enable Redis in production for scalable rate limiting and caching
# 8. Monitor OpenAI usage to prevent unexpected API costs
# 9. Use S3 in production for scalable file storage
# ==========================================
